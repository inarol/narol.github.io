angular.module("ui.datetimepicker",[]).directive("datetimepicker",[function(){return{restrict:"EA",require:"ngModel",scope:{options:"=datetimepicker"},link:function(e,i,t,a){var n=e.options||{},r=n.format||"yyyy-mm-dd",m={},o=n.LIMIT_START_TIME=angular.copy(n.limitStartTime),l=n.LIMIT_END_TIME=angular.copy(n.limitEndTime),T={};T.year=r.indexOf("yyyy")>=0,T.month=r.indexOf("mm")>=0,T.day=r.indexOf("dd")>=0,T.hour=r.indexOf("hh")>=0,T.mintue=r.indexOf("ii")>=0,T.second=r.indexOf("ss")>=0,m=angular.extend({weekStart:1,todayBtn:!0,todayHighlight:!0,customIcon:!0,format:r,autoclose:1,forceParse:0,bootcssVer:2,language:"zh-CN",clearBtn:n.clearBtn!==!1},m);T.year&&(m.startView=4,m.minView=4,m.maxView=4,T.month&&(m.startView=3,m.minView=3,m.maxView=4,T.day&&(m.startView=2,m.minView=2,m.maxView=4,T.hour&&(m.startView=2,m.minView=1,m.maxView=4,T.mintue&&(m.startView=2,m.minView=0,m.maxView=4)))));var c=i.datetimepicker(m),u=e.$watch("options.limitStartTime",function(e,t){e===t&&"undefined"==typeof t||i.datetimepicker("setStartDate",e)}),d=e.$watch("options.limitEndTime",function(e,t){e===t&&"undefined"==typeof t||i.datetimepicker("setEndDate",e)});n.removeDatetimepicker=function(){i.datetimepicker("remove"),u(),d()};var f=["show","hide","changeDate","changeYear","changeMonth","outOfRange","next"];angular.forEach(f,function(e){var i="on"+e[0].toUpperCase()+e.slice(1);angular.isFunction(n[i])&&c.on(e,n[i])});var s=function(){var i=n.relativeGroup(),t=i.groupId,r=i.relativeDatetime,m=i.relativeOptions,T=a.$modelValue;switch(t){case"startTime":if(T&&m.LIMIT_START_TIME){var c=new Date(T.replace(" ","T")).valueOf(),u=new Date(m.LIMIT_START_TIME.replace(" ","T")).valueOf();m.limitStartTime=c>u?T:m.LIMIT_START_TIME}else m.limitStartTime=m.LIMIT_START_TIME||T;if(r&&l){var d=new Date(r.replace(" ","T")).valueOf(),f=new Date(l.replace(" ","T")).valueOf();n.limitEndTime=f<d?l:r}else n.limitEndTime=l||r;break;case"endTime":if(T&&m.LIMIT_END_TIME){var c=new Date(T.replace(" ","T")).valueOf(),f=new Date(m.LIMIT_END_TIME.replace(" ","T")).valueOf();m.limitEndTime=f<c?m.LIMIT_END_TIME:T}else m.limitEndTime=m.LIMIT_END_TIME||T;if(r&&o){var d=new Date(r.replace(" ","T")).valueOf(),u=new Date(o.replace(" ","T")).valueOf();n.limitStartTime=d>u?r:o}else n.limitStartTime=o||r}e.$apply()},p=function(){$(i).blur()};c.on("hide",function(){p(),angular.isFunction(n.relativeGroup)&&s()})}}}]);