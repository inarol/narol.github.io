angular.module("ui.grid",[]),angular.module("ui.grid").factory("TableFactory",[function(){var t={};return t.defaultSettings={checkbox:!1,viewportNumbers:10,_emptyBodyHeight:80},t.createTable=function(e,n){var a=angular.extend({},t.defaultSettings,e.settings),e=e.options,i={};for(var l in n[0])n[0].hasOwnProperty(l)&&!e[l]&&(i[l]={hidden:!0});e=angular.extend({},e,i);var r=function(){var t={};for(var n in e)angular.isFunction(e[n].hidden)&&(e[n].hidden=e[n].hidden()||!1),t[n]=angular.extend({},e[n]);return t},o=function(t){var n={};for(var a in e)n[a]=t[a];return n},s=function(){for(var t=[],e=0;e<n.length;e++){var a=o(n[e]);c(a),t.push(a)}return t},c=function(t){for(var n in e)e[n].cellTemplate&&(t[n]=e[n].cellTemplate())};return{refresh:function(){this._watcherId=(new Date).getTime()},_watcherId:(new Date).getTime(),tableSettings:a,tableOptions:r(),tableList:s()}},t}]),angular.module("ui.grid").factory("TableHelper",[function(){var t={};return t.isDate=function(t){return"[object Date]"===Object.prototype.toString.call(t)&&!isNaN(t.getTime())},t.newDate=function(t){try{if(t&&!isNaN(Number(t)))return new Date(Number(t))}catch(e){throw new Error(e)}try{var n,a=t.split(" "),i=a[0].split("-");if(a[1]){var l=a[1].split(":");n=new Date(i[0],i[1]-1,i[2],l[0],l[1],l[2])}else n=new Date(i[0],i[1]-1,i[2]);return n}catch(e){throw new Error("translate error")}},t.format=function(t,e){if(!this.isDate(t))return"-";var t=t,n={"m+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"i+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in n)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?n[a]:("00"+n[a]).substr((""+n[a]).length)));return e},t.sort=function(t,e,n,a){if(!t.length)return t;switch(n="desc"===n?"desc":"asc",a="[object Function]"===Object.prototype.toString.apply(a)?a:function(t){return t},Object.prototype.toString.apply(a.call({},t[0][e]))){case"[object Number]":return t.sort(function(t,i){return"asc"===n?a.call({},t[e])-a.call({},i[e]):a.call({},i[e])-a.call({},t[e])});case"[object String]":return t.sort(function(t,i){return"asc"===n?a.call({},t[e]).localeCompare(a.call({},i[e])):a.call({},i[e]).localeCompare(a.call({},t[e]))});default:return t}},t.throttle=function(t,e){var n=null;return function(){var a=this,i=arguments;clearTimeout(n),n=setTimeout(function(){t.apply(a,i)},e)}},t.getScrollbarWidth=function(){var t=document.createElement("div");t.style.visibility="hidden",t.style.width="100px",t.style.msOverflowStyle="scrollbar",document.body.appendChild(t);var e=t.offsetWidth;t.style.overflow="scroll";var n=document.createElement("div");n.style.width="100%",t.appendChild(n);var a=n.offsetWidth;return t.parentNode.removeChild(t),e-a},t}]),angular.module("ui.grid").filter("tableCellTrans",["TableHelper",function(t){return function(e,n){var a=null===e||""===e;if(n.transValue){var i;if(angular.isFunction(n.transValue)){for(var l=n.transValue(),r={},o=l.list,s=l.key,c=l.value,d=0;d<o.length;d++)r[o[d][s]]=o[d][c];i=r[e]}else i=n.transValue[e];e=i||"-"}if(n.formatDate)try{e=t.format(t.newDate(e),n.formatDate)}catch(u){e="-"}if(n.toFixed)try{e=angular.isNumber(Number(e))&&!angular.equals(NaN,Number(e))?Number(e).toFixed(n.toFixed):"-"}catch(u){console.log(u)}return n.unitText&&(e+=n.unitText.toString()),a?"-":e}}]),angular.module("ui.grid").directive("angularTableBody",[function(){return{restrict:"EA",replace:!0,template:'<tbody>   <tr angular-table-row ng-class="{selected:tr.checked}" class="table-row" tr="tr" key="key" table-list="tableList" table-settings="tableSettings" table-options="tableOptions" select-row="selectRow(tr,$index)" ng-repeat="tr in viewportList">   </tr></tbody>',link:function(t,e,n){t.selectRow=function(e,n){for(var a=!0,i=0;i<t.viewportList.length;i++)if(!t.viewportList[i].checked){a=!1;break}t.selectAll=a}}}}]),angular.module("ui.grid").directive("tableCellCompile",["$compile",function(t){return function(e,n,a){e.$watch(function(t){return t.$eval(a.tableCellCompile)},function(a){n.html(a),t(n.contents())(e)})}}]),angular.module("ui.grid").directive("angularTableContent",["TableHelper","$timeout",function(t,e){return{restrict:"EA",scope:{tableList:"=",tableSettings:"=",tableOptions:"="},replace:!0,template:'<div>   <div class="table-header-wrapper">       <table class="table table-bordered table-hover table-striped">           <thead class="table-header" angular-table-header></thead>       </table>   </div>   <div class="table-body-wrapper">       <div class="table-body-inner" ng-show="tableList.length">           <table class="table table-bordered table-hover table-striped">               <tbody class="table-body" angular-table-body></tbody>           </table>       </div>       <div class="table-body-empty" ng-show="tableList.length === 0">           <strong class="text" ng-bind="::tableSettings.emptyPlaceholder"></strong>       </div>   </div></div>',link:function(n,a,i){n.gridScope=n.$parent.$parent;var l,r=$(a).closest(".table-wrapper"),o=$(a).find(".table-header-wrapper"),s=$(a).find(".table-body-wrapper"),c=s.find(".table-body-inner"),d=t.getScrollbarWidth(),u=40,p=120,b=n.tableSettings.viewportNumbers,h=!1,f=function(){var t=0,e=setTimeout(function(){s.css("left",0).scrollLeft(0),clearTimeout(e)},0);r.scrollLeft(0).on("scroll",function(e){var n=$(this).scrollLeft();t!==n&&(s.css("left",n),s.scrollLeft(n),t=n)})},g=n.renderViewportRows=function(t){var e="undefined"==typeof t?s.scrollTop():t;h=l<n.tableList.length*u,o.css("padding-right",h?d:0),h&&0!==t||s.scrollTop(0),s.css({"overflow-y":h?"auto":"hidden"}),c.css({"padding-top":e});var a=Math.round(e/u);n.viewportList=n.tableList.slice(a,a+b),n.$applyAsync()},v=function(){u=s.find(".table-row").outerHeight(),l=b*u,h=l<n.tableList.length*u,s.css({height:n.tableList.length>0?b*u:n.tableSettings._emptyBodyHeight}),c.css({height:n.tableList.length>0?n.tableList.length*u:n.tableSettings._emptyBodyHeight}),f(),g(0),y()},m=function(){n.viewportList=n.tableList.slice(0,b),s.on("scroll",function(){var t=this;window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;var e=function(){var e=$(t).scrollTop(),a=n.viewportList.length*u,i=n.tableList.length*u,l=e+a<i;g(l?e:i-a)};window.requestAnimationFrame?requestAnimationFrame(e):e()}),e(v,0)};n.$watch("$parent.tableOptions._watcherId",function(t,e){t===e&&"undefined"==typeof t||m()});var w=t.throttle(function(){y(),n.$applyAsync()},50);$(window).resize(w),$(window).on("window-resize",w);var y=n.resizeCellWidth=function(){var t=($(window).width(),r.scrollLeft()),e=s.scrollLeft();s.scrollLeft()!==t&&(r.scrollLeft(e),s.scrollLeft(e));var a=angular.copy(n.tableOptions),i=0,l=n.tableSettings&&n.tableSettings.checkbox?40:0,o=h?r.width()-d-2:r.width()-2,c=function(t){n.tableOptions[t].width=Math.max(n.tableOptions[t].width,p,r.find("[data-th-key='"+t+"']").find(".inner").outerWidth()+10),l+=parseInt(n.tableOptions[t].width)},u=function(t){var e=r.find("[data-th-key='"+t+"']").find(".th-inner"),i=r.find("[data-td-key='"+t+"']").find(".td-inner"),o=0;i.each(function(){o=Math.max($(this).outerWidth(!0),o)}),n.tableOptions[t].width=Math.max(o+16,e.outerWidth(),80,a[t].minWidth||0),l+=parseInt(n.tableOptions[t].width)};angular.forEach(a,function(t,e){n.tableOptions[e].hidden||("auto"!==a[e].width?c(e):a[e].cellTemplate?u(e):i++)});var b=function(){for(var t in a)if(!n.tableOptions[t].hidden&&!a[t].cellTemplate){n.tableOptions[t].width=Math.max(o-(l-n.tableOptions[t].width),p,a[t].minWidth||0);break}},f=function(){for(var t in a)if(!n.tableOptions[t].hidden&&"auto"===a[t].width&&!a[t].cellTemplate){var e=(o-l)/i;n.tableOptions[t].width=Math.max(e,p,a[t].minWidth||0)}};0===i?b():f()}}}}]),angular.module("ui.grid").directive("angularTableHeader",["$document","TableHelper",function(t,e){return{restrict:"EA",replace:!0,template:'<thead>   <tr>      <th class="th-checkbox" ng-show="::tableSettings.checkbox"><label><input type="checkbox" ng-model="selectAll" ng-change="checkAll()" /></label></th>      <th class="th-unit" data-th-key="{{::key}}" ng-if="!tableOptions[key].hidden" ng-repeat="key in objectKeys(tableOptions) track by $index" ng-style="{\'width\':tableOptions[key].width}" ng-class="{\'sort\':key===col}">          <div class="relative">             <span class="inner" ng-click="sort(key)">               <span class="table-sort" ng-class="{asc:\'down\', desc: \'up\'}[sortType]">                  <span class="icon-up"></span><span class="icon-down"></span></span>               <span class="th-inner" ng-bind="::tableOptions[key].ChineseName"></span>          </span>          <span class="th-resize" ng-mousedown="mousedown(key,$event)"></span>        </div>      </th>   </tr></thead>',link:function(n,a,i){n.col="";var l=n.sortType=null;n.sort=function(t){l=n.sortType="desc"===l?"asc":"desc",n.tableList=e.sort(n.tableList,t,l),n.col=t,n.renderViewportRows(0)},n.objectKeys=function(t){return Object.keys(t)};var r=$(a).closest(".table-wrapper");n.mousedown=function(e,a){function i(t){u.css({left:t.pageX-s.left+c})}function l(e){var a=(e.pageX,parseInt(u.offset().left)-d.offset().left),s=d.find(".inner").outerWidth()+10,a=Math.max(a,s),c=d.next(),p=c.data("th-key"),b=n.tableOptions[p],h=c.find(".inner");if(b.cellTemplate){var f=r.find("[data-td-key='"+p+"']").find(".td-inner"),g=0;f.each(function(){g=Math.max($(this).outerWidth(),g)});var v=Math.max(g+16,h.outerWidth()+10)}else var v=h.outerWidth()+10;var m=parseInt(n.tableOptions[p].width)+parseInt(n.tableOptions[o].width)-a;n.tableOptions[p].width=Math.max(m,v),n.tableOptions[o].width=a,n.$applyAsync(),u.css({left:-999999999}),r.removeClass("relative"),t.unbind("mousemove",i),t.unbind("mouseup",l)}a.preventDefault();var o=e,s=r.offset(),c=r.scrollLeft(),d=$(a.target).closest(".th-unit"),u=r.find(".resize-bar");a.pageX;t.bind("mousemove",i),t.bind("mouseup",l),u.css({left:a.pageX-s.left+c}),r.addClass("relative")},n.checkAll=function(){angular.forEach(n.tableList,function(t,e){t.checked=n.selectAll})}}}}]),angular.module("ui.grid").directive("angularTableRow",["$compile",function(t){return{restrict:"EA",scope:{tr:"=",key:"=",tableSettings:"=",tableOptions:"=",selectRow:"&",tableList:"="},link:function(e,n,a){e.gridScope=e.$parent.gridScope,e.$rowScope=e;var i,l=e.$parent,r=function(){i&&i.scope().$destroy();var a='<td class="td-checkbox" ng-show="::tableSettings.checkbox"><label><input type="checkbox" ng-model="tr.checked" ng-change="selectRow({tr:tr})" /></label></td><td data-td-key="{{::key}}" class="td-unit" ng-repeat="key in objectKeys(tr) track by $index" ng-init="td=tr[key]" ng-if="::tableOptions[key] && !tableOptions[key].hidden" ng-style="{\'width\':tableOptions[key].width}">   <div ng-if="::tableOptions[key].cellTemplate" table-cell-compile="::td" class="td-inner td-tpl"></div>   <div ng-if="::!tableOptions[key].cellTemplate" ng-bind="::td|tableCellTrans:tableOptions[key]" title="{{::td|tableCellTrans:tableOptions[key]}}" class="td-inner td-text"></div></td>',l=angular.element(a);i=t(l)(e.$new()),n.html(l)};e.objectKeys=function(t){return Object.keys(t)},r();var o=function(){for(var t=0;t<e.tableList.length;t++)if(e.tableList[t].$$hashKey===e.tr.$$hashKey)return t},s=function(){l.renderViewportRows(),l.resizeCellWidth()};e.refresh=function(){e.tableList.splice(o(),1,angular.copy(e.tr)),s()},e.remove=function(){e.tableList.splice(o(),1),e.$destroy(),s()}}}}]),angular.module("ui.grid").directive("angularTable",function(){return{restrict:"EA",scope:{tableOptions:"="},replace:!0,template:'<div class="table-responsive table-wrapper">   <angular-table-content table-list="tableOptions.tableList" table-settings="tableOptions.tableSettings" table-options="tableOptions.tableOptions">   </angular-table-content>   <div class="resize-bar"></div></div>',link:function(t,e,n){}}});